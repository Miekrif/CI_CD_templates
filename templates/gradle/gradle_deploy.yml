publish_job:
  stage: deploy
  image: $GRADLE_DOCKER_IMAGE
  rules:
    - if: $CI_COMMIT_TAG
      when: never
    - if: $CI_COMMIT_BRANCH == $CI_DEFAULT_BRANCH
  script:
    - gradle createRelease -Prelease.disableChecks
    - gradle publish
    - echo "TAG=$(gradle currentVersion -q -Prelease.quiet)" >> variables.env
  artifacts:
    reports:
      dotenv: variables.env
