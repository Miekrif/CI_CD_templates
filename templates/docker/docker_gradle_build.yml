docker_build:
  stage: build
  services:
    - name: safe-registry.alfastrah.ru/docker:25.0.5-dind
      alias: docker
  script:
    - docker build --build-arg JAR_NAME=$JAR_NAME -t $DOCKER_IMAGE:latest -t $DOCKER_IMAGE:$DOCKER_IMAGE_VERSION .
    - docker save -o $ARTIFACT_NAME.tar $DOCKER_IMAGE:latest $DOCKER_IMAGE:$DOCKER_IMAGE_VERSION
  needs: ["gradle_build"]
  artifacts:
    expire_in: 1 hour
    paths:
      - $ARTIFACT_NAME.tar
  only:
    - tags